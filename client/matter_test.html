<!doctype html> 
<html lang="en"> 
<style>
    canvas { /* float below */
        position: absolute;
        top: 0;
        left: 0;
        z-index: -1;
    }
</style>
<head> 
    <meta charset="UTF-8" />
    <title>matterjs test</title>
    <script src="//localhost:35729/livereload.js"></script>
    <script type="text/javascript" src="js/matter.min.js"></script>
</head>
<body>

<canvas width='500', height='500'></canvas>

<script type="text/javascript">

var ctx = document.getElementsByTagName('canvas')[0].getContext('2d');
var vx = 0, vy = 0;
var makesim = false;

var engine = Matter.Engine.create();
engine.world = Matter.World.create({gravity: {x:0, y:0}});
var tt = Matter.Bodies.circle(10, 10, 10, null, 32);
tt.friction = 1;
tt.frictionAir = 1;

var tt1 = Matter.Bodies.circle(10, 40, 10, null, 32);
tt1.friction = 1;
tt1.frictionAir = 1;

var tt3 = Matter.Bodies.circle(70, 10, 10, null, 32);
tt3.friction = 1;
tt3.frictionAir = 1;
var tt4 = Matter.Bodies.circle(70, 40, 10, null, 32);
tt4.friction = 1;
tt4.frictionAir = 1;

var bds = [tt, tt1, tt3, tt4];
Matter.World.add(engine.world, bds);

var time = Date.now();
window.setInterval(function(){
    var spd = 30; // m/s?
    if (makesim) {
        var shortTimeMs = 120;
        var longTimeMs = 480;
        var smallVel = spd/(shortTimeMs*1000);
        var longVel = spd/(longTimeMs*1000);
        console.log(smallVel);
        console.log(longVel);

        Matter.Body.translate(tt, {x:-tt.position.x + 10, y:-tt.position.y + 10});
        Matter.Body.translate(tt1, {x:-tt1.position.x + 10, y:-tt1.position.y + 40});

        Matter.Body.translate(tt3, {x:-tt3.position.x + 70, y:-tt3.position.y + 10});
        Matter.Body.translate(tt4, {x:-tt4.position.x + 70, y:-tt4.position.y + 40});
        

        tt.force = {x:smallVel, y:0};
        Matter.Engine.update(engine, shortTimeMs);
        tt.force = {x:smallVel, y:0};
        Matter.Engine.update(engine, shortTimeMs);
        tt.force = {x:smallVel, y:0};
        Matter.Engine.update(engine, shortTimeMs);
        tt.force = {x:smallVel, y:0};
        Matter.Engine.update(engine, shortTimeMs);
        console.log(tt.position);

        tt1.force = {x:longVel, y:0};
        Matter.Engine.update(engine, longTimeMs);
        console.log(tt1.position);
        makesim = false;
        return;
    }

    var now = Date.now();
    var dt = now - time;
    time = now;

    // Matter.Body.applyForce(tt, tt.position, {x:vx * 0.0001, y:vy* 0.0001});
    tt.force = {x:vx * spd/(dt * 1000), y:vy* spd/(dt * 1000)};
    Matter.Engine.update(engine, dt);

    ctx.clearRect(0, 0, 1000, 1000);

    for (var i = 0; i < bds.length; i++) {
        var b = bds[i];
        ctx.beginPath();
        ctx.arc(b.position.x, b.position.y, 10, 0, 2*Math.PI, false);
        ctx.fill();
        ctx.stroke();
    }

    // for (i = 0; i < rects.length; i++) {
    //     var b = rects[i];
    //     ctx.beginPath();
    //     // ctx.arc(b.position.x, b.position.y, 10, 0, 2*Math.PI, false);
    //     ctx.fillRect()
    //     ctx.fill();
    //     ctx.stroke();
    // }
    

    // console.log(dt);

}, 16);


document.onkeypress = function(event) {
    var t = event.charCode || event.keyCode;
    // console.log(event.key);
    if (t == 97) {
        vx = -1;
    } 
    if (t == 100) {
        vx = 1;
    }
    if (t == 115) {
        vy = 1;
    }
    if (t == 119) {
        vy = -1;
    }
    if (t == 13) {
        makesim = true;
    }

};

document.onkeyup = function(event) {
    // console.log(event.keyCode);
    if (event.keyCode == 65) {
        if (vx == -1)
            vx = 0;
    } 
    if (event.keyCode == 68) {
        if (vx == 1)
            vx = 0;
    }
    if (event.keyCode == 83) {
        if (vy == 1)
            vy = 0;
    }
    if (event.keyCode == 87) {
        if (vy == -1)
            vy = 0;
    }  
}


</script>

</body>
</html>